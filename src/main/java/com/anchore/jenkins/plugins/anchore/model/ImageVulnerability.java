package com.anchore.jenkins.plugins.anchore.model;

import org.apache.commons.lang.ObjectUtils;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;
import java.util.List;

public class ImageVulnerability {
    private int id = 0;

    private String cveId;
    private String severity;
    private String vulnerabilityPackage;
    private String url;
    private String fixAvailable;


    private String imagename;
    private String timestamp;
    private String availability;
    private String confidentiality;
    private Double cvssScore;
    private String cvssVector;
    private String cweId;
    private String identifier;
    private String integrity;

    public static void insertVulnerabilities(List<ImageVulnerability> vulnerabilities, Connection conn) throws SQLException {
        PreparedStatement statement = conn.prepareStatement("INSERT INTO IMAGEVULNERABILITY " +
                "(ID, AVAILABILITY, CONFIDENTIALITY, CVSSSCORE, CVSSVECTOR, CWEID, IDENTIFIER, IMAGENAME, INTEGRITY, TIMESTAMP) " +
                "VALUES (0, ?, ?, ?, ?, ?, ?, ?, ?, ?);");
        conn.setAutoCommit(false);
        for (ImageVulnerability vulnerability : vulnerabilities) {
            int i = 1;
            try {
                statement.setString(i++, vulnerability.getAvailability());
                statement.setString(i++, vulnerability.getConfidentiality());
                statement.setDouble(i++, vulnerability.getCvssScore());
                statement.setString(i++, vulnerability.getCvssVector());
                statement.setString(i++, vulnerability.getCweId());
                statement.setString(i++, vulnerability.getIdentifier());
                statement.setString(i++, vulnerability.getImagename());
                statement.setString(i++, vulnerability.getIntegrity());
                statement.setString(i++, vulnerability.getTimestamp());

                statement.addBatch();
            } catch (NullPointerException e) { }
        }
        statement.executeBatch();
        conn.commit();
    }

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getImagename() {
        return imagename;
    }

    public void setImagename(String imagename) {
        this.imagename = imagename;
    }

    public String getTimestamp() {
        return timestamp;
    }

    public void setTimestamp(String timestamp) {
        this.timestamp = timestamp;
    }

    public String getAvailability() {
        return availability;
    }

    public void setAvailability(String availability) {
        this.availability = availability;
    }

    public String getConfidentiality() {
        return confidentiality;
    }

    public void setConfidentiality(String confidentiality) {
        this.confidentiality = confidentiality;
    }

    public Double getCvssScore() {
        return cvssScore;
    }

    public void setCvssScore(Double cvssScore) {
        this.cvssScore = cvssScore;
    }

    public String getCvssVector() {
        return cvssVector;
    }

    public void setCvssVector(String cvssVector) {
        this.cvssVector = cvssVector;
    }

    public String getCweId() {
        return cweId;
    }

    public void setCweId(String cweId) {
        this.cweId = cweId;
    }

    public String getIdentifier() {
        return identifier;
    }

    public void setIdentifier(String identifier) {
        this.identifier = identifier;
    }

    public String getIntegrity() {
        return integrity;
    }

    public void setIntegrity(String integrity) {
        this.integrity = integrity;
    }

    public String getCveId() {
        return cveId;
    }

    public void setCveId(String cveId) {
        this.cveId = cveId;
    }

    public String getSeverity() {
        return severity;
    }

    public void setSeverity(String severity) {
        this.severity = severity;
    }

    public String getVulnerabilityPackage() {
        return vulnerabilityPackage;
    }

    public void setVulnerabilityPackage(String vulnerabilityPackage) {
        this.vulnerabilityPackage = vulnerabilityPackage;
    }

    public String getUrl() {
        return url;
    }

    public void setUrl(String url) {
        this.url = url;
    }

    public String getFixAvailable() {
        return fixAvailable;
    }

    public void setFixAvailable(String fixAvailable) {
        this.fixAvailable = fixAvailable;
    }
}
