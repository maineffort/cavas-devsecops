package com.anchore.jenkins.plugins.anchore;

import com.anchore.jenkins.plugins.anchore.model.ImageVulnerability;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.node.ObjectNode;
import net.sf.json.JSONArray;
import net.sf.json.JSONException;
import net.sf.json.JSONObject;
import org.apache.commons.io.IOUtils;
import org.junit.Test;

import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.nio.charset.Charset;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.ArrayList;
import java.util.List;

public class VulnerabilityDAOTest {
    static String readFile(String path, Charset encoding)
            throws IOException
    {
        byte[] encoded = Files.readAllBytes(Paths.get(path));
        return new String(encoded, encoding);
    }

    @Test
    public void testCorrelation() throws IOException, JSONException {
        InputStream stream = VulnerabilityDAOTest.class.getClassLoader().getResourceAsStream("vulnerabilities.json");
        String contents = IOUtils.toString(stream, StandardCharsets.UTF_8);
        JSONObject json = JSONObject.fromObject(contents);

        List<ImageVulnerability> imageVulnerabilities = VulnerabilityCorrelator.correlateVulnerabilitiesFromJson(json);
    }
}
